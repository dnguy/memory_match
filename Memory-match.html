<!DOCTYPE html>
<html>

<head>
    <title>Memory Match Game</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
    var my_card = null;
    var can_click = true;
    var attempts = 0;
    var successful_attempts = 0;
    var accuracy = 0.0;
    var seconds = 0;
    var start_time = null;
    var end_time = null;
    var imgArray = ['charizard.png', 'charizard.png', 'pikachu.jpeg', 'pikachu.jpeg', 'snorlax.jpg', 'snorlax.jpg', 'mewtwo.png', 'mewtwo.png', 'venusaur.jpg', 'venusaur.jpg', 'blastoise.jpeg', 'blastoise.jpeg', 'meowth.jpeg', 'meowth.jpeg', 'jigglypuff.jpeg', 'jigglypuff.jpeg', 'zapdos.jpg', 'zapdos.jpg']
    $(document).ready(function() {
        game_board();
    });

    function game_board() {
        shuffle(imgArray);
        for (var i = 0; i < imgArray.length; i++) {
            var img = $('<img>').attr('src', 'images/' + imgArray[i]).addClass('card card-front').attr('id', 'card_front' + (i + 1)).attr('data-card', imgArray[i]);
            var img_back = $('<img>').attr('src', 'images/back-card.jpeg').addClass('card card-back').attr('id', 'card_back' + (i + 1)).attr('onclick', 'card_click(' + (i + 1) + ')');
            var game_cards = $('<div>').addClass('card_container').attr('id', 'card_container' + (i + 1));
            $(game_cards).append(img, img_back);
            $('.game-area').append(game_cards);
        }
    }

    function shuffle(array) {
        var currentIndex = array.length,
            temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }

    function card_click(card_number) {
        var card_front = '#card_front' + card_number;
        var card_back = '#card_back' + card_number;

        if (start_time == null) {
            start_time = new Date;
            console.log(start_time)
        }
        if (can_click == false) {
            console.log("disallow clicking")
            return;
        }
        $(card_back).toggleClass('card_back_selected');
        $(card_front).toggleClass('card_front_selected');
        if (my_card == null) {

            console.log('first card was clicked, on card1, it was ' + $(card_front).attr('data-card'));
            my_card = $(card_front).attr('data-card');
            can_click = false;
            setTimeout(function() {
                can_click = true;
            }, 600);


        } else {
            attempts = attempts + 1;
            if (attempts > 0) {
                console.log('attempts is equal to : ' + attempts)
                $('.attempts').html(attempts);
            }
            console.log('second card was clicked, it was card 1, it was ' + $(card_front).attr('data-card'));
            if (my_card == $(card_front).attr('data-card')) {
                console.log('they match');
                successful_attempts += 1;
                if (successful_attempts > 0) {
                    accuracy = (successful_attempts / attempts * 100);
                    var a = accuracy.toFixed(0);
                    $('.accuracy').html(a + '%');
                }
                can_click = false;
                setTimeout(function() {
                    $('.card_front_selected').addClass('card-match-front');
                    $('.card_back_selected').addClass('card-match-back');
                    can_click = true;
                }, 900);
                if (successful_attempts == 9) {
                    end_time = new Date;
                    console.log(end_time);

                    function getElapsedTime() {
                        if (end_time != null)
                            console.log(end_time - start_time);
                    }

                    setTimeout(function() {
                        alert("Congratulations! You are now a Pokemon Master!")
                    }, 1400);
                }

            } else {
                can_click = false;
                if (successful_attempts >= 0) {
                    accuracy = (successful_attempts / attempts * 100);
                    var a = accuracy.toFixed(0);
                    $('.accuracy').html(a + '%');
                }
                console.log('they do not match');
                setTimeout(function() {
                    $('.card_front_selected').removeClass('card_front_selected');
                    $('.card_back_selected').removeClass('card_back_selected');
                    can_click = true;
                }, 1000);

            }
            my_card = null
        }
    }

    function gameReset() {
        $('.card-match-front').removeClass('card-match-front');
        $('.card-match-back').removeClass('card-match-back');
        $('.card_front_selected').removeClass('card_front_selected');
        $('.card_back_selected').removeClass('card_back_selected');
        my_card = null
        successful_attempts = 0;
        attempts = 0;
        accuracy = 0;
        $('.attempts').html('000')
        $('.accuracy').html('100%')
        $(".card").hide('slow');
        $(".start_game").show('slow');
        $('.game-area').html('');
        game_board();
    }

    function game_start() {
        $(".start_game").hide('slow');
        $(".card").show('slow');
    }

    function secondPassed() {
        var minutes = Math.round(seconds / 60);
        var remainingSeconds = seconds % 60;
        if (seconds > 59 && remainingSeconds > 9) {
            seconds++;
            $('#countdown').html(minutes + ":" + remainingSeconds);
        } else if (seconds > 59) {
            seconds++;
            $('#countdown').html(minutes + ":0" + remainingSeconds);
        } else if (seconds > 9) {
            ++seconds;
            $('#countdown').html("0:" + seconds);
        } else if (seconds >= 0) {
            seconds++;
            $('#countdown').html("0:0" + seconds);

        }
    }

    var countdownTimer = setInterval('secondPassed()', 1000);
    </script>
</head>

<body>
    <audio autoplay>
        <source src="pokemon.mp3" type="audio/mpeg">
    </audio>
    <img class="background_image" src="images/pokeball.png">
    <div class="header">
        <div class="game-logo">
            <img class="pikachu-logo" src="images/pikachu-logo.png">
            <img class="charmander-logo" src="images/charmander-logo.png">
            <img class="squirtle-logo" src="images/squirtle-logo.png">
        </div>
        <h1> Pokemon: Gotta Match Em' All</h1>
        <button class="reset" onclick="gameReset()">Reset Game</button>
    </div>
    <div class="game-info">
        <h1>Stats:</h1>
        <p>Time played:</p>
        <div id="countdown" class="time">0:00</div>
        <p>Number of tries:</p>
        <div class="attempts">000</div>
        <p>Accuracy:</p>
        <div class="accuracy">100%</div>
    </div>
    <div onclick="game_start()" class="start_game">
        <p>Click to release the Pokemon!</p>
        <img class="pokeball" src="images/pokeball_start.png">
    </div>
    <div class="game-area">
    </div>
    </div>
    </div>
</body>

</html>
